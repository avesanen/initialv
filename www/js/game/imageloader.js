// Generated by CoffeeScript 1.6.2
/*
# Image loader. Loads images for animations and caches them in a buffer.
*/


(function() {
  define(["jquery", "exports"], function($, exports) {
    var buffer;
    buffer = {};
    /*
    # Initialize image loader with array of image URLs
    # The array can have many images for one index (sub images for animations)
    #
    # @param images Image URLs in array(s)
    # @param callback
    */

    exports.imageLoader = function(images, callback) {
      var img, that, url;
      that = this;
      if (!images.length) {
        callback(that.buffer);
      }
      url = images.shift();
      if (url in that.buffer) {
        that.imageLoader(images, callback);
        return;
      }
      img = new Image();
      img.onload = function() {
        that.buffer[url] = img;
        return that.imageLoader(images, callback);
      };
      img.onError = function() {
        console.error("404: " + url);
        return that.imageLoader(images, callback);
      };
      return img.src = url;
    };
    /*
    # Get image from buffer, or load it to buffer (first time) and get that
    # @param image Usually relative URL to the image
    */

    exports.getImage = function(image) {
      var img;
      if (buffer[image]) {
        return buffer[image];
      } else {
        img = new Image();
        buffer[image] = img;
        img.src = image;
        return img;
      }
    };
  });

}).call(this);
