// Generated by CoffeeScript 1.6.2
/*
# Sound effects
*/


(function() {
  define(["jquery", "exports"], function($, exports) {
    /*
    # Constructor
    */

    exports.init = function() {
      var that;
      this.bgm = new Audio();
      if (this.bgm.canPlayType("audio/ogg; codecs=vorbis")) {
        this.useExt = ".ogg";
      } else {
        this.useExt = ".mp3";
      }
      this.sfx = Array();
      this.sfxCount = 0;
      this.loadedSfxCount = 0;
      that = this;
      return $.getJSON("sfx.json", function(data) {
        return $.each(data, function(key, val) {
          that.sfx[key] = new Audio(val + that.useExt);
          that.sfxCount++;
          return that.sfx[key].addEventListener("canplaythrough", (function() {
            that.loadedSfxCount++;
            return console.log("sfx count: " + that.loadedSfxCount + "/" + that.sfxCount);
          }), false);
        });
      });
    };
    /*
    # Begin playing a background music forever
    # @param basename Base name of the file (no extension or path)
    */

    exports.playBgm = function(basename) {
      this.bgm.pause();
      this.bgm.src = "audio/" + basename + this.useExt;
      this.bgm.addEventListener("ended", (function() {
        this.currentTime = 0;
        return this.play();
      }), false);
      return this.bgm.play();
    };
    /*
    #Q Stop playing the background music
    */

    exports.stopBgm = function() {
      return this.bgm.stop();
    };
    /*
    # Play a preloaded sound effect
    # @param number Index of the sound effect
    */

    exports.playSfx = function(number) {
      if (this.sfx[number].currentTime > 0) {
        this.sfx[number].pause();
        this.sfx[number].currentTime = 0;
      }
      return this.sfx[number].play();
    };
    /*
    # Stop playing a preloaded sound effect
    # @param number
    */

    exports.stopSfx = function(number) {
      return this.sfx[number].pause();
    };
  });

}).call(this);
